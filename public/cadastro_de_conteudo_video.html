<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de conteúdo - [vídeo]</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/css/bootstrap.min.css"
      integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />   
    <style>
      body {
        background-color: #f8f9fa;
      }

      .youtube-icon,
      .fa-pencil,
      .fa-trash-can {
        color: gray;
        cursor: pointer;
      }

      .youtube-icon:hover,
      .fa-pencil:hover,
      .fa-trash-can:hover {
        transition: all .2s ease;
        transform: scale(1.2);
      }

      .youtube-tester:hover {
        transition: all .2s ease;
        transform: scale(1.2);
      }

      .div-label-normalize {
        display: flex;
        justify-content: space-between;
      }

      .normalize {
        cursor: pointer;
      }

      .ferramentas-right i {
        color: #726d6d;
        margin-left: 8px;
      }

      .ferramentas-right .rubber,
      .copy,
      .youtube-tester {
        cursor: pointer;
      }

      .link-youtube {
        text-decoration: none;
        color: #212529;
      }

      .link-youtube:hover {
        color: #212529;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12 d-flex justify-content-center mt-2">
          <h1>Cadastro de vídeo do Youtube</h1>
        </div>
      </div>
      <form id="cadastro_video">
        <div class="row g-3 mt-1">
          <div class="col-md-2">
            <label for="categoria" class="form-label">Categoria</label>
            <select
              class="form-select"
              id="categoria"
              required=""
              name="categoria"
            >
              <option value="">Categoria...</option>
              <option value="1">Css</option>
              <option value="2">Html</option>
              <option value="3">Javascript</option>
              <option value="4">Sem categoria</option>
            </select>
          </div>
        </div>

        <div class="row g-3 mt-1">
          <div class="col-md-5">
            <label for="nomevideo" class="form-label">Vídeo</label>
            <input
              type="text"
              class="form-control"
              id="nomevideo"
              required=""
              name="nomevideo"
              placeholder=""
            />
          </div>
          <div class="col-md-2">
            <div class="div-label-normalize">
              <label for="codigoyt" class="form-label">Código</label>
              <span class="ferramentas-right"
                ><i class="fa-solid fa-eraser rubber"></i
                ><i class="fa-solid fa-copy copy"></i
                ><!--<i class="fa-solid fa-arrow-down-9-1 normalize"></i
              >--><i class="fa-solid fa-screwdriver-wrench normalize"></i
                ><a class="youtube-link-tester" href="" target="_blank"
                  ><i class="fa-brands fa-youtube-square youtube-tester"></i></a
              ></span>
            </div>
            <input
              type="text"
              class="form-control"
              id="codigoyt"
              required=""
              name="codigoyt"
              placeholder=""
            />
          </div>
        </div>

        <button class="btn btn-primary submit mt-2" type="submit">Salvar</button>
      </form>
      <div class="row">
        <div class="col-md-7">
          <table class="table lista-videos">
            <thead>
              <tr>
                <th>#</th>
                <th>Título</th>
                <th>Código</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>









<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Excluir vídeo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancela</button>
        <button type="button" class="btn btn-primary">Confirma</button>
      </div>
    </div>
  </div>
</div>



















    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/js/bootstrap.min.js"
      integrity="sha512-EKWWs1ZcA2ZY9lbLISPz8aGR2+L7JVYqBAYTq5AXgBkSjRSuQEGqWx8R1zAX16KdXPaCjOCaKE8MCpU0wcHlHA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      const _listaVideos = document.querySelector(".lista-videos tbody");
      const _normalize = document.querySelector(".normalize");
      const _rubber = document.querySelector(".rubber");
      const _copy = document.querySelector(".copy");
      const _youtubeLinkTester = document.querySelector(".youtube-link-tester");

      _copy.addEventListener("click", function () {
        navigator.clipboard.writeText(_codigoyt.value);
      });
      _rubber.addEventListener("click", function () {
        console.log("cliquei no rubber");
        _codigoyt.value = "";
      });
      _normalize.addEventListener("click", function () {
        if (_codigoyt.value === "" || _codigoyt.value === null) {
          console.log("campo codigo está vazio");
          return;
        } else {
          let link = codigoyt.value;
          if (!link.includes("watch?v=")) {
            return;
          } else {
            let partes = link.split("watch?v=");
            if (partes[1].length > 11) {
              console.log("é uma playlist");
              _codigoyt.value = partes[1].substring(0, 11);
              _youtubeLinkTester.setAttribute(
                "href",
                `https://www.youtube.com/watch?v=${_codigoyt.value}`
              );
            } else {
              console.log("é um vídeo simples");
              _codigoyt.value = partes[1];
              _youtubeLinkTester.setAttribute(
                "href",
                `https://www.youtube.com/watch?v=${_codigoyt.value}`
              );
            }
            return;
          }
        }
      });


      // inicio do código ajax listagem inicial - cadastro de vídeo avulso
      $.ajax({
        type: "POST",
        url: "lista.php",
        dataType: "json",
        encode: true,
      }).done(function (data) {
        for (let i = 0; i < data.length; i++) {
          console.log(data[i].descricao, data[i].codigo);
        }
        for (let i = 0; i < data.length; i++) {
          let _tr = document.createElement("tr");
          let _td1 = document.createElement("td");
          let _td2 = document.createElement("td");
          let _td3 = document.createElement("td");
          let _td4 = document.createElement("td");
          let _td5 = document.createElement("td");
          let _nodeText1 = document.createTextNode(data[i].id);
          let _nodeText2 = document.createTextNode(data[i].descricao);
          let _nodeText3 = document.createTextNode(data[i].codigo);
          _td1.appendChild(_nodeText1);
          _td2.appendChild(_nodeText2);
          let texto_t2 = _td2.textContent;
          _td2.textContent = texto_t2;
          _td2.innerHTML =
            `<a href="https://www.youtube.com/watch?v=${data[i].codigo}" class="link-youtube" target="_blank"><i class="fa-brands fa-youtube youtube-icon"></i> ${texto_t2}</a>`;
          _td3.appendChild(_nodeText3);
          _td4.innerHTML = '<i class="fa-solid fa-pencil"></i>';
          _td5.innerHTML = '<i class="fa-solid fa-trash-can" data-bs-toggle="modal" data-bs-toggle="modal" data-bs-target="#deleteModal"></i>';
          _tr.appendChild(_td1);
          _tr.appendChild(_td2);
          _tr.appendChild(_td3);
          _tr.appendChild(_td4);
          _tr.appendChild(_td5);
          _listaVideos.appendChild(_tr);
        }
      });
      // fim do código ajax listagem inicial - cadastro de vídeo avulso

      // inicio do código ajax envio - cadastro de vídeo avulso
      $(document).ready(function () {
        $("form").submit(function (event) {
          var formData = {
            categoria: $("#categoria").val(),
            nomevideo: $("#nomevideo").val(),
            codigoyt: $("#codigoyt").val(),
          };
          $.ajax({
            type: "POST",
            url: "recebe.php",
            data: formData,
            dataType: "json",
            encode: true,
          }).done(function (data) {
            console.log(data);
            console.log(typeof data);
            let _ultimoAdicionado = data.length - 1;
            console.log(
              data[_ultimoAdicionado].descricao,
              data[_ultimoAdicionado].codigo
            );
            let _tr = document.createElement("tr");
            let _td1 = document.createElement("td");
            let _td2 = document.createElement("td");
            let _td3 = document.createElement("td");
            let _td4 = document.createElement("td");
            let _td5 = document.createElement("td");
            let _nodeText1 = document.createTextNode(
              data[_ultimoAdicionado].id
            );
            let _nodeText2 = document.createTextNode(
              data[_ultimoAdicionado].descricao
            );
            let _nodeText3 = document.createTextNode(
              data[_ultimoAdicionado].codigo
            );
            _td1.appendChild(_nodeText1);
            _td2.appendChild(_nodeText2);
            let texto_t2 = _td2.textContent;
            _td2.textContent = texto_t2;
            _td2.innerHTML =
              '<i class="fa-brands fa-youtube youtube-icon"></i> ' + texto_t2;
            _td3.appendChild(_nodeText3);
            _td4.innerHTML = '<i class="fa-solid fa-pencil"></i>';
            _td5.innerHTML = '<i class="fa-solid fa-trash-can" data-bs-toggle="modal" data-bs-toggle="modal" data-bs-target="#deleteModal"></i>';
            _tr.appendChild(_td1);
            _tr.appendChild(_td2);
            _tr.appendChild(_td3);
            _tr.appendChild(_td4);
            _tr.appendChild(_td5);
            _listaVideos.appendChild(_tr);
            /*}*/
            _select_categoria.value = "";
            _nomevideo.value = "";
            _codigoyt.value = "";
          });
          event.preventDefault();
        });
      });
      // fim do código ajax envio - cadastro de vídeo avulso

      const _select_categoria = document.querySelector("#categoria");
      const _nomevideo = document.querySelector("#nomevideo");
      const _codigoyt = document.querySelector("#codigoyt");
      const _form = document.querySelector("form");
      const _buttonSubmit = document.querySelector(".submit");


      let quantidadeCampos = 1;

      const _videos = document.querySelectorAll(".video");
      const _tipo = document.querySelector("#tipo");
      _tipo_escolhido = "video";

    </script>
  </body>
</html>
